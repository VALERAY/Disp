# МОДЕЛЬ БИЗНЕС-ПРОЦЕССОВ СИСТЕМЫ "ДИСПЕТЧЕР ЗАЯВОК"

## АННОТАЦИЯ

Данный документ представляет полную модель бизнес-процессов системы "Диспетчер заявок", разработанной для автоматизации обработки заявок граждан в сфере жилищно-коммунального хозяйства. Модель включает описание ролей пользователей, основных процессов, алгоритмов обработки данных и технической архитектуры системы.

## 1. ОБЩАЯ ХАРАКТЕРИСТИКА СИСТЕМЫ

### 1.1 Назначение системы
Система "Диспетчер заявок" предназначена для:
- Автоматизации процесса приема и обработки заявок граждан
- Управления жизненным циклом заявок от создания до закрытия
- Ведения учета и отчетности по заявкам
- Обеспечения контроля качества обслуживания

### 1.2 Основные функции
- **Управление заявками**: создание, редактирование, удаление, изменение статусов
- **Управление пользователями**: регистрация, авторизация, управление ролями
- **Фильтрация и поиск**: многоуровневая система фильтров и поиска
- **Отчетность**: экспорт данных в различных форматах
- **Аналитика**: статистика и аналитические отчеты

## 2. РОЛИ ПОЛЬЗОВАТЕЛЕЙ И ИХ ПРАВА

### 2.1 Администратор (admin)
**Основные права:**
- Полный доступ ко всем функциям системы
- Управление пользователями (создание, редактирование, удаление)
- Доступ к административной панели
- Настройка параметров системы
- Управление базой данных

**Бизнес-процессы:**
```
АДМИНИСТРАТОР
    ↓
ВХОД В СИСТЕМУ
    ↓
ДОСТУП К АДМИН-ПАНЕЛИ
    ↓
┌─────────────────┬─────────────────┐
│ УПРАВЛЕНИЕ      │ НАСТРОЙКА       │
│ ПОЛЬЗОВАТЕЛЯМИ  │ СИСТЕМЫ         │
└─────────────────┴─────────────────┘
    ↓                     ↓
СОЗДАНИЕ/РЕДАКТИРОВАНИЕ  ИЗМЕНЕНИЕ ПАРАМЕТРОВ
    ↓                     ↓
СОХРАНЕНИЕ ИЗМЕНЕНИЙ    СОХРАНЕНИЕ НАСТРОЕК
```

### 2.2 Оператор (user)
**Основные права:**
- Создание новых заявок
- Просмотр и редактирование заявок
- Фильтрация и поиск заявок
- Экспорт данных
- Обновление статусов заявок

**Бизнес-процессы:**
```
ОПЕРАТОР
    ↓
ВХОД В СИСТЕМУ
    ↓
ДОСТУП К ГЛАВНОМУ МЕНЮ
    ↓
┌─────────────────┬─────────────────┬─────────────────┐
│ СОЗДАНИЕ        │ ПРОСМОТР        │ ЭКСПОРТ         │
│ ЗАЯВОК          │ ЗАЯВОК          │ ДАННЫХ          │
└─────────────────┴─────────────────┴─────────────────┘
```

## 3. ОСНОВНЫЕ БИЗНЕС-ПРОЦЕССЫ

### 3.1 Процесс авторизации
**Описание:** Процесс входа пользователя в систему с проверкой учетных данных.

**Участники:** Пользователь, Система, База данных

**Алгоритм:**
1. Пользователь вводит логин и пароль
2. Система проверяет учетные данные в БД
3. При успешной проверке - открытие главного окна
4. При неуспешной проверке - показ ошибки

**Код реализации:**
```python
def login():
    username = entry_login.get()
    password = entry_password.get()
    cursor.execute("SELECT * FROM common.users WHERE username=? AND password= ?", (username, password))
    user = cursor.fetchone()
    if user:
        login_window.destroy()
        open_main_window(user)
    else:
        messagebox.showwarning("Ошибка", "Неверный логин или пароль")
```

### 3.2 Процесс создания заявки
**Описание:** Основной процесс создания новой заявки с валидацией данных.

**Участники:** Оператор, Система, База данных

**Алгоритм:**
1. Заполнение формы заявки
2. Валидация введенных данных
3. Сохранение в базе данных
4. Присвоение уникального ID
5. Уведомление о создании
6. Обновление интерфейса

**Код реализации:**
```python
def add_record():
    name = name_entry.get()
    surname = surname_entry.get()
    problem_text = problem_entry.get()
    phone = phone_entry.get()
    address = address_entry.get()
    date = datetime.now().strftime("%Y-%m-%d")
    created_at = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    cursor.execute("INSERT INTO records (...) VALUES (...)", (...))
    conn.commit()
    new_id = cursor.lastrowid
    show_auto_close_info(f"Заявка создана. Порядковый номер: {new_id}")
```

### 3.3 Процесс обработки заявки
**Описание:** Процесс изменения статуса и содержания заявки.

**Участники:** Оператор, Система, База данных

**Алгоритм:**
1. Выбор заявки из списка
2. Выбор действия (редактирование/изменение статуса/удаление)
3. Внесение изменений
4. Сохранение в БД
5. Обновление интерфейса

### 3.4 Процесс фильтрации и поиска
**Описание:** Процесс поиска и фильтрации заявок по различным критериям.

**Участники:** Пользователь, Система, База данных

**Алгоритм:**
1. Установка критериев фильтрации
2. Построение SQL-запроса
3. Выполнение запроса
4. Отображение результатов

**Код реализации:**
```python
def get_filtered_rows(keyword=None, start_date=None, end_date=None):
    query = """SELECT r.id, r.name, r.surname, r.problem, r.phone, r.address,
                       COALESCE(r.created_at, r.date) AS created_at,
                       r.assignment_date, r.status, u.username 
               FROM records r 
               LEFT JOIN common.users u ON r.user_id = u.id"""
    where_clauses = []
    params = []
    
    if keyword:
        where_clauses.append("(LOWER(r.name) LIKE ? OR LOWER(r.surname) LIKE ? OR LOWER(r.problem) LIKE ?)")
        params.extend([f"%{keyword}%", f"%{keyword}%", f"%{keyword}%"])
    
    if where_clauses:
        query += " WHERE " + " AND ".join(where_clauses)
    cursor.execute(query, params)
    return cursor.fetchall()
```

### 3.5 Процесс экспорта данных
**Описание:** Процесс формирования и экспорта отчетов в различных форматах.

**Участники:** Пользователь, Система, Файловая система

**Алгоритм:**
1. Выбор типа экспорта
2. Применение фильтров (если необходимо)
3. Формирование данных
4. Создание Excel-файла
5. Сохранение файла
6. Уведомление пользователя

## 4. ЖИЗНЕННЫЙ ЦИКЛ ЗАЯВКИ

### 4.1 Статусы заявок
```
СОЗДАНИЕ → НЕ ВЫПОЛНЕНО → В РАБОТЕ → ВЫПОЛНЕНО → ЗАКРЫТО
    ↓           ↓            ↓           ↓          ↓
  Новый      Ожидает      Активная    Готово    Архив
  статус     обработки    работа      к сдаче
```

### 4.2 Переходы между статусами
- **Создание** → **Не выполнено**: автоматически при создании
- **Не выполнено** → **В работе**: при назначении исполнителя
- **В работе** → **Выполнено**: при завершении работ
- **Выполнено** → **Закрыто**: при подтверждении заказчиком

## 5. КАТЕГОРИИ ПРОБЛЕМ И АВТОМАТИЧЕСКАЯ КЛАССИФИКАЦИЯ

### 5.1 Категории проблем
- **Водоснабжение**: течь воды, автоматика на водоводе, дефекты колонок
- **Канализация**: течь канализации, засоры, автоматика на коллекторе
- **Колодцы**: забитые/открытые колодцы
- **Благоустройство**: пожарные гидранты, частные врезки, водяные колонки

### 5.2 Алгоритм классификации
```python
def category_for(problem_text: str) -> str:
    text = problem_text.lower()
    
    if "течь" in text and "канализ" in text:
        return "ТЕЧЬ КАНАЛИЗАЦИИ"
    elif "течь" in text and "вод" in text:
        return "ТЕЧЬ ВОДЫ"
    elif "ав" in text and "водовод" in text:
        return "АВТОМАТИКА НА ВОДОВОДЕ"
    elif "гидрант" in text or "пг" in text:
        return "ПОЖАРНЫЕ ГИДРАНТЫ"
    elif "врезк" in text or "частн" in text:
        return "ЧАСТНЫЕ ВРЕЗКИ"
    elif "колонк" in text:
        return "ВОДЯНЫЕ КОЛОНКИ"
    
    return "ДРУГОЕ"
```

## 6. ТЕХНИЧЕСКАЯ АРХИТЕКТУРА

### 6.1 Компоненты системы
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ПОЛЬЗОВАТЕЛЬ  │    │   ПРИЛОЖЕНИЕ   │    │   БАЗА ДАННЫХ  │
│                 │    │                 │    │                 │
│ • GUI Interface │◄──►│ • Business Logic│◄──►│ • SQLite DB    │
│ • Tkinter       │    │ • Data Access   │    │ • Users Table  │
│ • Forms         │    │ • Validation    │    │ • Records Table│
│ • Controls      │    │ • Export Engine│    │ • Monthly Split│
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 6.2 Слой данных
- **SQLite Database**: основное хранилище данных
- **Помесячное разделение**: автоматическое создание БД по месяцам
- **Миграция схемы**: автоматическое обновление структуры БД
- **Транзакции**: обеспечение целостности данных

### 6.3 Слой бизнес-логики
- **Валидация данных**: проверка корректности введенной информации
- **Фильтрация**: алгоритмы поиска и фильтрации
- **Экспорт**: формирование отчетов в различных форматах
- **Классификация**: автоматическое определение категорий проблем

## 7. ИНТЕГРАЦИИ И ЭКСПОРТ

### 7.1 Форматы экспорта
- **Excel (.xlsx)**: основной формат для отчетов
- **Структурированные данные**: для интеграции с внешними системами

### 7.2 Типы отчетов
1. **Текущий список**: экспорт отфильтрованных заявок
2. **Отчет за период**: статистика за выбранный период
3. **Сводный отчет**: агрегированная статистика
4. **Ежедневный бланк**: форма для ежедневной отчетности

## 8. БЕЗОПАСНОСТЬ И КОНТРОЛЬ ДОСТУПА

### 8.1 Аутентификация
- Логин/пароль для входа в систему
- Возможность запоминания учетных данных
- Автоматический выход при неактивности

### 8.2 Авторизация
- Ролевая модель доступа (admin/user)
- Ограничение функций по ролям
- Аудит действий пользователей

### 8.3 Защита данных
- Валидация входных данных
- Защита от SQL-инъекций
- Шифрование чувствительных данных

## 9. МОНИТОРИНГ И АНАЛИТИКА

### 9.1 Ключевые метрики
- Количество заявок по периодам
- Время обработки заявок
- Статистика по категориям проблем
- Производительность операторов

### 9.2 Отчетность
- Ежедневные отчеты
- Месячная статистика
- Анализ трендов
- Экспорт для внешних систем

## 10. РАЗВИТИЕ СИСТЕМЫ

### 10.1 Планируемые улучшения
- Веб-интерфейс для удаленного доступа
- Мобильное приложение для полевых работ
- Интеграция с внешними системами
- Расширенная аналитика и BI
- Автоматические уведомления

### 10.2 Масштабируемость
- Поддержка множественных пользователей
- Сетевая архитектура
- Облачное развертывание
- API для интеграций

## ЗАКЛЮЧЕНИЕ

Модель бизнес-процессов системы "Диспетчер заявок" представляет собой комплексное решение для автоматизации обработки заявок граждан. Система обеспечивает полный цикл управления заявками от создания до закрытия, включая ролевую модель доступа, автоматическую классификацию проблем, гибкую систему фильтрации и экспорта данных.

Архитектура системы построена на современных принципах разработки с использованием Python, SQLite и Tkinter, что обеспечивает высокую производительность, надежность и простоту сопровождения.

Данная модель может служить основой для дальнейшего развития системы и интеграции с другими информационными системами организации.

