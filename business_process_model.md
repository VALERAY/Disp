# МОДЕЛЬ БИЗНЕС-ПРОЦЕССОВ СИСТЕМЫ "ДИСПЕТЧЕР ЗАЯВОК"

## 1. ОБЗОР СИСТЕМЫ

Система "Диспетчер заявок" предназначена для автоматизации процесса обработки заявок граждан в сфере жилищно-коммунального хозяйства. Система обеспечивает полный цикл обработки заявок от поступления до закрытия.

## 2. РОЛИ ПОЛЬЗОВАТЕЛЕЙ

### 2.1 Администратор (admin)
**Права и возможности:**
- Управление пользователями (создание, редактирование, удаление)
- Доступ к админ-панели
- Настройка параметров системы
- Полный доступ ко всем функциям

### 2.2 Оператор (user)
**Права и возможности:**
- Создание новых заявок
- Просмотр и редактирование заявок
- Фильтрация и поиск заявок
- Экспорт данных
- Обновление статусов заявок

## 3. ОСНОВНЫЕ БИЗНЕС-ПРОЦЕССЫ

### 3.1 Процесс авторизации
```
НАЧАЛО
    ↓
Ввод логина и пароля
    ↓
Проверка в БД пользователей
    ↓
[Валидные данные?]
    ↓ ДА                    ↓ НЕТ
Открытие главного окна    Показ ошибки
    ↓
КОНЕЦ
```

### 3.2 Процесс создания заявки
```
НАЧАЛО
    ↓
Заполнение формы заявки:
- Имя и фамилия заявителя
- Описание проблемы
- Телефон
- Адрес
- Срок выполнения
- Статус
- Благоустройство
    ↓
Валидация данных
    ↓
[Данные корректны?]
    ↓ ДА                    ↓ НЕТ
Сохранение в БД          Показ ошибки
    ↓
Присвоение ID заявки
    ↓
Уведомление о создании
    ↓
Обновление списка заявок
    ↓
КОНЕЦ
```

### 3.3 Процесс обработки заявки
```
НАЧАЛО
    ↓
Просмотр списка заявок
    ↓
Выбор заявки для обработки
    ↓
[Действие с заявкой]
    ↓
┌─────────────────┬─────────────────┬─────────────────┐
│   РЕДАКТИРОВАНИЕ │   ИЗМЕНЕНИЕ     │     УДАЛЕНИЕ    │
│                 │    СТАТУСА      │                 │
└─────────────────┴─────────────────┴─────────────────┘
    ↓                    ↓                    ↓
Обновление данных    Обновление статуса   Удаление записи
    ↓                    ↓                    ↓
Сохранение в БД      Сохранение в БД     Удаление из БД
    ↓                    ↓                    ↓
Обновление списка    Обновление списка   Обновление списка
    ↓                    ↓                    ↓
КОНЕЦ              КОНЕЦ              КОНЕЦ
```

### 3.4 Процесс фильтрации и поиска
```
НАЧАЛО
    ↓
Установка критериев фильтрации:
- Ключевое слово
- Диапазон дат
- Статус заявки
- Оператор
- Тип проблемы
    ↓
Выполнение SQL-запроса
    ↓
Получение отфильтрованных данных
    ↓
Отображение результатов
    ↓
КОНЕЦ
```

### 3.5 Процесс экспорта данных
```
НАЧАЛО
    ↓
Выбор типа экспорта:
- Текущий список
- За период
- По фильтрам
- Сводный отчет
- Ежедневный бланк
    ↓
Применение фильтров (если необходимо)
    ↓
Формирование данных для экспорта
    ↓
Создание Excel-файла
    ↓
Сохранение файла
    ↓
Уведомление об успешном экспорте
    ↓
КОНЕЦ
```

## 4. СХЕМА ПОТОКА ДАННЫХ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   ПОЛЬЗОВАТЕЛЬ  │    │   СИСТЕМА       │    │   БАЗА ДАННЫХ  │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │ 1. Авторизация       │                       │
         ├──────────────────────►│                       │
         │                       │ 2. Проверка учетных   │
         │                       │    данных             │
         │                       ├──────────────────────►│
         │                       │ 3. Результат проверки │
         │                       │◄──────────────────────┤
         │ 4. Результат          │                       │
         │◄──────────────────────┤                       │
         │                       │                       │
         │ 5. Создание заявки    │                       │
         ├──────────────────────►│                       │
         │                       │ 6. Валидация данных   │
         │                       │                       │
         │                       │ 7. Сохранение заявки  │
         │                       ├──────────────────────►│
         │                       │ 8. ID заявки          │
         │                       │◄──────────────────────┤
         │ 9. Уведомление        │                       │
         │◄──────────────────────┤                       │
         │                       │                       │
         │ 10. Просмотр заявок   │                       │
         ├──────────────────────►│                       │
         │                       │ 11. Запрос данных     │
         │                       ├──────────────────────►│
         │                       │ 12. Список заявок      │
         │                       │◄──────────────────────┤
         │ 13. Отображение       │                       │
         │◄──────────────────────┤                       │
         │                       │                       │
         │ 14. Фильтрация        │                       │
         ├──────────────────────►│                       │
         │                       │ 15. SQL-запрос        │
         │                       ├──────────────────────►│
         │                       │ 16. Отфильтрованные   │
         │                       │     данные             │
         │                       │◄──────────────────────┤
         │ 17. Результаты        │                       │
         │◄──────────────────────┤                       │
         │                       │                       │
         │ 18. Экспорт данных    │                       │
         ├──────────────────────►│                       │
         │                       │ 19. Формирование      │
         │                       │     Excel-файла       │
         │                       │                       │
         │ 20. Файл для          │                       │
         │     скачивания       │                       │
         │◄──────────────────────┤                       │
```

## 5. СТАТУСЫ ЗАЯВОК

### 5.1 Жизненный цикл заявки
```
СОЗДАНИЕ → НЕ ВЫПОЛНЕНО → В РАБОТЕ → ВЫПОЛНЕНО → ЗАКРЫТО
    ↓           ↓            ↓           ↓          ↓
  Новый      Ожидает      Активная    Готово    Архив
  статус     обработки    работа      к сдаче
```

### 5.2 Возможные статусы:
- **Не выполнено** - заявка создана, но еще не взята в работу
- **В работе** - заявка находится в процессе выполнения
- **Выполнено** - заявка выполнена, ожидает подтверждения
- **Закрыто** - заявка полностью закрыта

## 6. КАТЕГОРИИ ПРОБЛЕМ

Система автоматически классифицирует заявки по категориям:

### 6.1 Водоснабжение
- Течь воды
- Автоматика на водоводе
- Дефект водоразборной колонки
- Ржавая холодная вода

### 6.2 Канализация
- Течь канализации
- Засор канализации
- Автоматика на канализационном коллекторе

### 6.3 Колодцы и благоустройство
- Забит колодец
- Открыт колодец
- Пожарные гидранты
- Частные врезки
- Водяные колонки

## 7. АЛГОРИТМЫ ОБРАБОТКИ ДАННЫХ

### 7.1 Алгоритм фильтрации
```python
def get_filtered_rows(keyword, start_date, end_date):
    query = "SELECT * FROM records WHERE 1=1"
    conditions = []
    params = []
    
    if keyword:
        conditions.append("(name LIKE ? OR surname LIKE ? OR problem LIKE ?)")
        params.extend([f"%{keyword}%", f"%{keyword}%", f"%{keyword}%"])
    
    if start_date and end_date:
        conditions.append("date(date) BETWEEN ? AND ?")
        params.extend([start_date, end_date])
    
    if conditions:
        query += " AND " + " AND ".join(conditions)
    
    return execute_query(query, params)
```

### 7.2 Алгоритм классификации проблем
```python
def category_for(problem_text):
    text = problem_text.lower()
    
    if "течь" in text and "канализ" in text:
        return "ТЕЧЬ КАНАЛИЗАЦИИ"
    elif "течь" in text and "вод" in text:
        return "ТЕЧЬ ВОДЫ"
    elif "ав" in text and "водовод" in text:
        return "АВТОМАТИКА НА ВОДОВОДЕ"
    elif "гидрант" in text or "пг" in text:
        return "ПОЖАРНЫЕ ГИДРАНТЫ"
    elif "врезк" in text or "частн" in text:
        return "ЧАСТНЫЕ ВРЕЗКИ"
    elif "колонк" in text:
        return "ВОДЯНЫЕ КОЛОНКИ"
    
    return "ДРУГОЕ"
```

## 8. ИНТЕГРАЦИИ И ЭКСПОРТ

### 8.1 Форматы экспорта
- **Excel (.xlsx)** - основной формат для отчетов
- **Структурированные данные** - для интеграции с другими системами

### 8.2 Типы отчетов
1. **Текущий список** - экспорт отфильтрованных заявок
2. **Отчет за период** - статистика за выбранный период
3. **Сводный отчет** - агрегированная статистика
4. **Ежедневный бланк** - форма для ежедневной отчетности

## 9. БЕЗОПАСНОСТЬ И КОНТРОЛЬ ДОСТУПА

### 9.1 Аутентификация
- Логин/пароль для входа в систему
- Возможность запоминания учетных данных
- Автоматический выход при неактивности

### 9.2 Авторизация
- Ролевая модель доступа (admin/user)
- Ограничение функций по ролям
- Аудит действий пользователей

### 9.3 Защита данных
- Шифрование паролей в БД
- Валидация входных данных
- Защита от SQL-инъекций

## 10. МОНИТОРИНГ И АНАЛИТИКА

### 10.1 Ключевые метрики
- Количество заявок по периодам
- Время обработки заявок
- Статистика по категориям проблем
- Производительность операторов

### 10.2 Отчетность
- Ежедневные отчеты
- Месячная статистика
- Анализ трендов
- Экспорт для внешних систем

## 11. ТЕХНИЧЕСКАЯ АРХИТЕКТУРА

### 11.1 Компоненты системы
- **Frontend**: Tkinter GUI
- **Backend**: Python + SQLite
- **Data Layer**: SQLite Database
- **Export Engine**: Pandas + OpenPyXL

### 11.2 Хранение данных
- Помесячное разделение БД
- Автоматическая миграция схемы
- Резервное копирование
- Сетевое хранение (опционально)

## 12. РАЗВИТИЕ СИСТЕМЫ

### 12.1 Планируемые улучшения
- Веб-интерфейс
- Мобильное приложение
- Интеграция с внешними системами
- Расширенная аналитика
- Автоматические уведомления

### 12.2 Масштабируемость
- Поддержка множественных пользователей
- Сетевая архитектура
- Облачное развертывание
- API для интеграций

